function randomFix(e,t){return void 0===e?console.error("plz set randomFix(num:Number) or randomFix(num:Number,fix:Number)"):(t=void 0===t?0:t,Math.floor(Math.random()*e)+t)}function resize_canvas(){let e=window.innerWidth,t=window.innerHeight,n=document.getElementById("wrapper"),o=document.getElementById("preload"),r=document.getElementById("robot"),a=e/t,c=16/9,i=a<=c?e/1280:t/720,s=1280*i+"px",l=720*i+"px",d="translate(-50%,-50%) scale("+1.4*i+")";n.style.width=o.style.width=s,n.style.height=o.style.height=l,r&&(r.style.transform=d)}function sound_Channel(e,t,n){if(t){for(i=0;i<mp3Ary.length;i++)if(mp3Ary[i])try{mp3Ary[i].stop()}catch(e){console.log(e)}mp3Ary.length=0,mp3Ary=[]}if("stop"!=e){var o=createjs.Sound.play(e,{interrupt:createjs.Sound.INTERRUPT_EARLY,loop:n});mp3Ary.push(o)}}function playSound(e){mus_bo&&sound_Channel(e,!1,0)}var mp3Ary,mp,testQus=!1,keyList={"`":"停留原地",1:"向前/後走一步(shift)",2:"向前/後走二步(shift)",3:"向前/後走三步(shift)",Q:"遊戲總測驗",D:"命運模式",C:"機會模式",G:"遊戲模式"};(function(e){window.onload=function(){function t(e){function t(e){for(var t=[];;){var o=e.match(a);if(null===o)return t;o[0]=o[0].slice(1,-1),t.push({src:f+"ex/"+o[0]+n,id:o[0]}),e=e.replace(a,"")}}var n=".png",o=[],r=[],a=/\[[A-Za-z0-9]+\]/;for(var c in o=o.concat(e.OX),o=o.concat(e.QA),o)for(var i in r=r.concat(t(o[c].qus)),o[c].opt)r=r.concat(t(o[c].opt[i][0]));return r}function n(e){"image"==e.item.type&&(images[e.item.id]=e.result)}function o(){console.log("校園文化製作 http://www.eduweb.com.tw/"),preload.style.display="none",topic.style.display="block",topic.addEventListener("click",r),b=new lib.game,m=new createjs.Stage(g),m.addChild(b),b.startBtn.visible=!1,b.restartBtn.visible=!1,m.update(),m.enableMouseOver(),resize_canvas()}function r(e){topic.style.display="none",topic.removeEventListener("click",r),createjs.Ticker.framerate=12,createjs.Ticker.addEventListener("tick",m),c(),b.musBtn.gotoAndStop(1),p(b.helpBtn,!0),p(b.startBtn,!0),p(b.musBtn,!0),p(b.edulogo,!0),p(b.restartBtn,!0)}function a(){function e(e){a<=0?(c.prefBtn.alpha=.5,c.nextBtn.alpha=1,a=0):a+1>=c.totalFrames?(c.prefBtn.alpha=1,c.nextBtn.alpha=.5,a=c.totalFrames-1):(c.prefBtn.alpha=1,c.nextBtn.alpha=1),c.gotoAndStop(a)}function t(t){e(++a)}function n(t){e(--a)}function o(){}function r(e){c.visible=!1,b.helpBtn.alpha=1,b.helpBtn.cursor="pointer",c.removeEventListener("click",o),c.nextBtn.removeEventListener("click",t),c.prefBtn.removeEventListener("click",n),c.closeBtn.removeEventListener("click",r)}var a=0,c=b.helpMc;c.visible=!0,b.helpBtn.alpha=.5,b.helpBtn.cursor="auto",c.nextBtn.cursor="pointer",c.prefBtn.cursor="pointer",c.closeBtn.cursor="pointer",c.nextBtn.addEventListener("click",t),c.prefBtn.addEventListener("click",n),c.closeBtn.addEventListener("click",r),c.addEventListener("click",o),e(a)}function c(){sound_Channel("mp3_bg0",!0,-1),h(),k.length=0,k=[],b.gotoAndStop(0),mus_bo=!0,b.startBtn.visible=!1,b.restartBtn.visible=!1,b.musBtn.cursor="pointer",b.musBtn.hitArea=b.musBtn.getChildAt(0),b.titleBg.gotoAndStop(0),b.titleMc.scaleX=b.titleMc.scaleY=1,b.titleMc.txt.text=e.classname,b.titleMc.subtxt.text=e.subtitle,b.titleMc.x=640,b.titleMc.y=180,b.helpBtn.x=103,p(b.selectBtn1),p(b.selectBtn2),p(b.selectBtn3),p(b.selectBtn4)}function i(){function e(){b.startBtn.removeEventListener("click",e);for(var t=1;t<=7;t++)b["btn_chr"+t].removeEventListener("click",n);s()}function t(){for(var e in k)if(null==k[e].char)return e-0+1;return!0}function n(e){var n=e.currentTarget,o=t();0==n.currentFrame&&"number"==typeof o?(n.gotoAndPlay(0),n.playerTxt.text=o+"P",k[o-1].char=n.i,k[o-1].name=n.nameTxt.text,n.player=o-0):(n.gotoAndStop(0),n.playerTxt.text="",n.player&&(k[n.player-1].char=null,k[n.player-1].name=null,n.player=null)),b.startBtn.visible=!0===t()}function o(e){setTimeout(function(){b["btn_chr"+e].visible=!0},750+150*e)}function r(){for(var e=1;e<=7;e++)b["btn_chr"+e].visible=!1,b["btn_chr"+e].gotoAndStop(0),b["btn_chr"+e].playerTxt.text="",o(e),b["btn_chr"+e].i=e,b["btn_chr"+e].player=null,b["btn_chr"+e].hitArea=b["btn_chr"+e].getChildAt(0),b["btn_chr"+e].addEventListener("click",n)}function a(){for(var e=0;e<k.length;e++)k[e]={char:null,name:null,control:"player",score:0,coin:0};var t=["單人練習","雙人ＰＫ","三人競賽","四人爭霸"];b.tipTxt.text=t[k.length-1]+"選擇角色"}h(),b.gotoAndStop(1),createjs.Tween.get(b.titleMc).to({x:1110,y:70,scaleX:.36,scaleY:.36},300),b.titleBg.play(),a(),r(),b.startBtn.addEventListener("click",e)}function s(){function t(){for(var e in k)N.removeChild(k[e].chr);N.removeChild(R),N.removeChild(O),N.removeChild(D),N.removeChild(U),U&&U.dispatchEvent(W),U=void 0,r()}function n(){b.restartBtn.removeEventListener("click",n),b.gameoverBtn.removeEventListener("click",o),h(),a(),t(),c()}function o(){1==b.gameoverBtn.alpha&&(x(!1),b.gameoverBtn.removeEventListener("click",o),R.visible=!1,O.alpha=0,O.gotoAndStop(11),a(),u(T))}function r(){for(var e in X)N.removeChild(X[e]);X.length=0,X=[]}function a(){q.cursor="auto",q.removeEventListener("click",i),N.removeChild(q)}function i(){x(!1),a(),O.gotoAndPlay(10),setTimeout(function(){createjs.Tween.get(O).to({y:620,alpha:0},300),g(z,O.i)},3e3)}function s(){O.x=750,O.y=500,O.alpha=1,O.scaleX=O.scaleY=1.2,N.addChild(O),N.addChild(q),O.gotoAndPlay(0),O.i=randomFix(3,1),"AI"==k[z].control?i():(q.cursor="pointer",q.addEventListener("click",i))}function l(){k.length>1&&b.scoreMc["player"+(z-0+1)].gotoAndStop(0),B()}function u(r){function c(e){if(f(e.detail),U.removeEventListener("end",c),N.removeChild(U),U=void 0,e.detail.end)return b.restartBtn.removeEventListener("click",n),b.gameoverBtn.removeEventListener("click",o),a(),t(),void d();var r=0,i=1,s=2,h=3,p=4,m=5,y=6;switch(D.visible=!1,e.detail.event){case r:case i:g(z,e.detail.value,!0);break;case s:u(M);break;case h:u(T);break;case p:u(_);break;case m:u(S);break;case y:var B=Math.floor(v());v(B);default:l()}}function i(){U.removeEventListener("end",c),U.removeEventListener("gameEnd",i)}var s=[],h=1===k.length;switch(U=null,r){case w:console.log("Event %cSTART%c Flag","color: #0F0","color: #000");break;case A:console.log("Event %cChance%c Flag","color: #F00","color: #000"),U=setRandomEvent(Q,h);break;case L:console.log("Event %cDestiny%c Flag","color: #F00","color: #000"),U=setRandomEvent(Y,h);break;case M:console.log("Event %cGAME%c Flag","color: #00F","color: #000"),U=setGameEvent(m);break;case _:console.log("Event %cOX%c Question","color: #F0F","color: #000"),s=s.concat(e.OX),U=setGameQuestion(C,s);break;case S:console.log("Event %cQA%c Question","color: #F0F","color: #000"),s=s.concat(e.QA),U=setGameQuestion(F,s);break;case T:console.log("Event %cEND%c Flag","color: #0F0","color: #000"),s=s.concat(e.OX),s=s.concat(e.QA),U=setGameQuestion(j,s);break;default:console.log("Event (Flag) be nothing...")}U?(D.visible=!0,U.addEventListener("end",c),U.addEventListener("gameEnd",i),N.addChild(U)):l()}function v(e){for(var t=0,n=0;n<k.length;n++)e?(k[n].coin=e,b.scoreMc["player"+(n-0+1)].coinTxt.text=e):t+=k[n].coin;return t/k.length}function g(e,t,n){function o(){r.step+=t/Math.abs(t),r.step===X.length?r.step=0:-1===r.step&&(r.step=X.length-1);var e=X[r.step].x+a,i=X[r.step].y-c,s=X[r.step].flag;createjs.Tween.get(r).to({x:(e+r.x)/2,y:r.y-30},100).to({x:e,y:i},200).wait(100).call(function(){t-=t/Math.abs(t),0===t?n?l():u(s):o()})}var r=k[e].chr,a=10,c=.8*r.nominalBounds.height-25;if(void 0===t)return r.x=X[0].x+a,r.y=X[0].y-c,void(r.step=0);R.visible=!1,0!==t?o():u(X[r.step].flag)}function f(e){var t=k[z],n=null;t.score+=e.score,t.coin+=e.coin,n=k.length>1?b.scoreMc["player"+(z-0+1)]:b.scoreMc,n.scoreTxt.text=t.score,n.coinTxt.text=t.coin}function y(e,t){var n=k[t],o=new lib["chr"+n.char],r=0;e.charMc.gotoAndStop(n.char-1),e.nameTxt.text=n.name,e.scoreTxt.text=n.score,e.coinTxt.text=n.coin,n.chr=o,o.scaleX=o.scaleY=.8,N.addChild(o),r=N.getChildIndex(o),I=r>I?r:I,g(t)}function B(){z=z<k.length-1?z+1:0;var e=k[z].chr;R.x=e.x+25,R.scaleY=e.y>70?Math.abs(R.scaleY):-Math.abs(R.scaleY),R.y=e.y>70?e.y-50:e.y+.8*e.nominalBounds.height+50,R.visible=!0,x(!0),s(),N.setChildIndex(k[z].chr,I),k.length>1&&b.scoreMc["player"+(z-0+1)].gotoAndStop(1)}function x(e){1===k.length&&(b.gameoverBtn.alpha=e?1:.5,b.gameoverBtn.cursor=e?"pointer":"auto")}function E(e){var t=null,n=null,o=e.which||e.keyCode;if(!(O.currentFrame>10)){switch(o){case 192:n=0;break;case 49:n=e.shiftKey?-1:1;break;case 50:n=e.shiftKey?-2:2;break;case 51:n=e.shiftKey?-3:3;break;case 81:t=T;break;case 67:t=A;break;case 68:t=L;break;case 71:t=M}null!==n&&(O.i=n,0===n?(a(),g(z,O.i)):i(),x(!1)),t&&(R.visible=!1,O.alpha=0,O.gotoAndStop(11),a(),u(t),x(!1))}}var w=0,A=1,L=2,M=3,_=4,S=5,T=6,C=0,F=1,j=2,Q=0,Y=1,X=[],I=0,G=-20,P=100,z=-1,N=b.gameObj,O=new lib.diceMc,R=new lib.dc,D=new createjs.Shape((new createjs.Graphics).f("rgba(0,0,0,0.6)").dr(0,0,1e3,720)),q=new createjs.Shape((new createjs.Graphics).f("rgba(0,0,0,0.01)").dr(730,480,220,240)),K=new lib.site0,H=new lib.site6,U=void 0,W=new CustomEvent("gameEnd");sound_Channel("mp3_bg2",!0,-1),h(),b.gotoAndStop(2),b.mapMc.gotoAndStop(e.bg),b.helpBtn.x=1030,b.restartBtn.visible=!0,b.startBtn.visible=!1,D.visible=!1,O.hitArea=O.getChildAt(0),p(b.gameoverBtn),K.flag=0,H.flag=6,X.push(K);for(var Z=0;Z<16;Z++){var J=randomFix(5,1),V=new lib["site"+J];V.flag=J,X.push(V)}for(var $ in X.push(H),X){switch(N.addChild(X[$]),!0){case $<6:G+=130;break;case 6==$:G+=60,P+=100;break;case $<9:P+=160;break;case 9==$:G-=60,P+=100;break;case $<15:G-=130;break;case 15==$:G-=60,P-=100;break;default:P-=160}X[$].x=G+16*Math.random()-8,X[$].y=P+30*Math.random()-15}if(k.length>1){b.scoreMc.gotoAndStop(1),b.gameoverBtn.visible=!1;for(var ee=0;ee<4;ee++){var te=b.scoreMc["player"+(ee-0+1)];k.length-1<ee?te.visible=!1:(te.visible=!0,te.gotoAndStop(0),y(te,ee))}}else b.scoreMc.gotoAndStop(0),y(b.scoreMc,0),b.gameoverBtn.visible=!0,b.gameoverBtn.addEventListener("click",o);N.addChild(R),N.addChild(D),b.restartBtn.addEventListener("click",n),testQus&&(console.log("- 鍵盤快捷鍵查詢請輸入【keyList】"),addEventListener("keydown",E)),B()}function l(e){var t=e.currentTarget;switch(t){case b.selectBtn1:k.length=1,i();break;case b.selectBtn2:k.length=2,i();break;case b.selectBtn3:k.length=3,i();break;case b.selectBtn4:k.length=4,i();break;case b.btn_chr1:t.play();break;case b.helpBtn:if(1!=b.helpBtn.alpha)return;a();break;case b.musBtn:mus_bo=!mus_bo,createjs.Sound.muted=!mus_bo,b.musBtn.gotoAndStop(Number(mus_bo));break;case b.edulogo:window.open("http://www.eduweb.com.tw/","校園文化")}}function d(){function e(){b.restartBtn.removeEventListener("click",e),b.helpBtn.visible=!0,c()}function t(e,t){e.charMc.gotoAndStop(t.char-1),e.nameTxt.text=t.name,e.scoreTxt.text=t.score,e.coinTxt.text=t.coin}var n=new Date,o=b.statisticsMc,r=0,a=0;if(h(),b.helpBtn.visible=!1,b.restartBtn.visible=!0,b.restartBtn.addEventListener("click",e),b.titleMc.scaleX=b.titleMc.scaleY=.4,b.titleMc.x=640,b.titleMc.y=90,b.gotoAndStop(3),b.dateTxt.text="中華民國  "+(n.getFullYear()-1911)+" 年 "+(n.getMonth()+1)+" 月 "+n.getDate()+" 日",k.length>1){o.gotoAndStop(1);for(var i=1;i<=4;i++){var s=o["player"+i],l=k[i-1];i>k.length?s.visible=!1:(s.visible=!0,t(s,l),a=a<l.coin?l.coin:a,r=r<l.score?l.score:r)}for(var d=0;d<4;d++){s=o["player"+(d+1)],l=k[d];if(d+1>k.length)break;s.highMc.visible=l.score===r&&r>0,s.richMc.visible=l.coin===a&&a>0}}else o.gotoAndStop(0),t(o,k[0]);switch(k.length){case 2:o.x=490;break;case 3:o.x=380;break;default:o.x=255}}function u(e){var t=e.currentTarget;t.scaleX=1.03*t.osx,t.scaleY=1.03*t.osy}function v(e){var t=e.currentTarget;t.scaleX=t.osx,t.scaleY=t.osy}function h(){for(var e in x)x[e].cursor="auto",x[e].removeEventListener("click",l),x[e].removeEventListener("mouseover",u),x[e].removeEventListener("mouseout",v);x.length=0,x=[]}function p(e,t){t||x.push(e),e.cursor="pointer",e.osx=e.scaleX,e.osy=e.scaleY,e.addEventListener("click",l),e.addEventListener("mouseover",u),e.addEventListener("mouseout",v)}var g,m,b,f="res/";input_txt=document.getElementById("input_txt"),g=document.getElementById("canvas"),preload=document.getElementById("preload"),topic=document.getElementById("topic"),images=images||{};var y=[{src:f+"bg.jpg",id:"bg"},{src:f+"bg0.mp3",id:"mp3_bg0"},{src:f+"bg2.mp3",id:"mp3_bg2"}];y=y.concat(t(e)),document.title=e.title,resize_canvas(),window.addEventListener("resize",resize_canvas),createjs.Sound.registerPlugins([createjs.HTMLAudioPlugin]),createjs.Sound.alternateExtensions=["ogg"];var B=new createjs.LoadQueue(!1);B.installPlugin(createjs.Sound),B.addEventListener("fileload",n),B.addEventListener("complete",o),B.loadManifest(y);var x=[],k=[]}})(qq_str),mus_bo=!0,mp3Ary=[];